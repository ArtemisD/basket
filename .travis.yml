language: node_js
sudo: required
services:
- docker

before_install:
  - docker --version  # document the version travis is using
  - pip install --user awscli # install aws cli w/o sudo
  - export PATH=$PATH:$HOME/.local/bin # put aws in the path
  - eval $(aws ecr get-login --no-include-email --region us-east-2) #needs AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY envvars
  #- docker pull 767596259046.dkr.ecr.us-east-2.amazonaws.com/basket-starter:latest
install:
- docker build -t basket .

script:
 - docker run -it -p 8000:8000 basket npm test

deploy:
  provider: elasticbeanstalk
  access_key_id: AKIAJAUQER3J3AKWB3CQ
  secret_access_key:
    secure: AWS_SECRET_ACCESS_KEY
  region: us-east-1
  app: thesis2
  env: thesistest
  bucket_name: elasticbeanstalk-us-east-1-767596259046